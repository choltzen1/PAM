{% extends "base.html" %}
{% block title %}Edit Promotion – {{ promo.code }}{% endblock %}
{% block content %}
  <!-- Header -->
  <header class="header">
    <div class="header-title">Edit Promotion – {{ promo.code }}</div>
    <div class="user-name">{{ user_name }}</div>
  </header>
  <div class="container main-container">
    <div class="layout-wrapper">
      <!-- LEFT PANEL -->
      <div class="left-panel">
        <!-- General Info Box -->
        <div class="info-section">
          <div class="info-section-title">General Information</div>
          <div><b>Promo Owner:</b> {{ promo.owner }}</div>
          <div><b>Bill Facing Name:</b> {{ promo.bill_facing_name }}</div>
          <div><b>Orbit ID:</b> {{ promo.orbit_id }}</div>
          <div><b>PJ Code:</b> {{ promo.pj_code }}</div>
          <div><b>Restricted:</b> Not Dark</div>
        </div>
        <!-- Description Box -->
        <div class="info-section">
          <div class="info-section-title">Description</div>
          <div class="info-section-content">{{ promo.description }}</div>
          <div><b>Promo Notes:</b></div>
          <div class="promo-notes">{{ promo.promo_notes }}</div>
        </div>
        <!-- Updates Box -->
        <div class="info-section">
          <div class="info-section-title">Updates</div>
          <div><b>Promo % Discount:</b> {{ promo.discount }}</div>
          <div><b>Promo Amount:</b> {{ promo.amount }}</div>
          <div><b>DCD Web In-Cart:</b> {{ 'Y' if promo.dcd_web_cart == 'Y' else 'N' }}</div>
          <div><b>Product Type:</b> {{ promo.product_type }}</div>
          <div><b>BOGO:</b> {{ 'Yes' if promo.bogo == 'Y' else 'No' }}</div>
          <div><b>Trade-in Group ID:</b> {{ promo.trade_in_group_id }}</div>
        </div>
        <!-- Version History Box -->
        <div class="info-section">
          <div class="info-section-title">Version History</div>
          <div class="version-history">
            {% for entry in promo.version_history %}
              <div>{{ entry }}</div>
            {% endfor %}
          </div>
        </div>
      </div>
      <!-- RIGHT PANEL -->
      <div class="right-panel">
        <div class="tabs">
          {% for tab in ['Details','Dates & Times','Requirements','Segmentation','Groupings','BPTCR','Export to CSV'] %}
            <a href="{{ url_for('edit_promo', promo_code=promo.code, tab=tab) }}"
               class="tab {% if tab == active_tab %}active{% endif %}">
              {{ tab }}
            </a>
          {% endfor %}
        </div>
        <form method="post" class="form-wrapper">
          {# Tab state is preserved on POST by reading 'active_tab' from the form #}
          <input type="hidden" name="active_tab" value="{{ active_tab }}">
          {% if active_tab == 'Details' %}
            <!-- Details Tab Content (Editable) -->
            <div class="grid-4-col">
              <div class="field-label col-span-full">Bill Facing Name</div>
              <input class="form-control col-span-full form-control-mb" name="bill_facing_name" value="{{ promo.bill_facing_name }}">

              <div class="field-label">Promo % Discount</div>
              <div class="field-label">Promo Amount ($)</div>
              <div class="field-label">NSEIP Drop</div>
              <div class="field-label">DCD Web Cart</div>
              <input class="form-control" name="discount" value="{{ promo.discount }}" type="number" min="0" step="0.01" placeholder="%">
              <input class="form-control" name="amount" value="{{ promo.amount }}" type="number" min="0" step="0.01" placeholder="$">
              <select class="form-select" name="nseip_drop">
                <option value="Y" {% if promo.nseip_drop == 'Y' %}selected{% endif %}>Yes</option>
                <option value="N" {% if promo.nseip_drop == 'N' %}selected{% endif %}>No</option>
              </select>
              <select class="form-select" name="dcd_web_cart">
                <option value="Y" {% if promo.dcd_web_cart == 'Y' %}selected{% endif %}>Yes</option>
                <option value="N" {% if promo.dcd_web_cart == 'N' %}selected{% endif %}>No</option>
              </select>

              <div class="field-label-spaced col-span-full">Product Type</div>
              <input class="form-control col-span-full form-control-mb" name="product_type" value="{{ promo.product_type }}">

              <div class="field-label">BOGO</div>
              <div class="field-label">Bolt Trade-In Group ID</div>
              <div class="field-label">FPD Display Promo</div>
              <div class="field-label">On Menu</div>
              <select class="form-select" name="bogo">
                <option value="Y" {% if promo.bogo == 'Y' %}selected{% endif %}>Yes</option>
                <option value="N" {% if promo.bogo == 'N' %}selected{% endif %}>No</option>
              </select>
              <input class="form-control" name="trade_in_group_id" value="{{ promo.trade_in_group_id }}">
              <select class="form-select" name="fpd_display_promo">
                <option value="Y" {% if promo.fpd_display_promo == 'Y' %}selected{% endif %}>Yes</option>
                <option value="N" {% if promo.fpd_display_promo == 'N' %}selected{% endif %}>No</option>
              </select>
              <select class="form-select" name="on_menu">
                <option value="Y" {% if promo.on_menu == 'Y' %}selected{% endif %}>Yes</option>
                <option value="N" {% if promo.on_menu == 'N' %}selected{% endif %}>No</option>
              </select>

              <div class="field-label-spaced col-span-half">Market Group</div>
              <div class="field-label-spaced col-span-half-right">Store Group</div>
              <input class="form-control col-span-half" name="market_group" value="*">
              <input class="form-control col-span-half-right" name="store_group" value="*">

              <div class="field-label-spaced col-span-full">SKU Link Address</div>
              <input class="form-control col-span-full" name="sku_link" value="https://web.powerapps.com/webplayer/iframe...">
              <div class="field-label-spaced col-span-full">Trade-In Link Address</div>
              <input class="form-control col-span-full" name="tradein_link" value="https://web.powerapps.com/webplayer/iframe...">
            </div>
          {% elif active_tab == 'Dates & Times' %}
            <!-- Dates & Times Tab Content (Editable) -->
            <div class="grid-4-col-responsive">

              <!-- Promo Start Date, End Date, Comm End Date, Promo Duration (Legacy style) -->
              <div class="field-label-no-margin">Promo Start Date</div>
              <div class="field-label-no-margin">Promo End Date</div>
              <div class="field-label-no-margin">Comm End Date</div>
              <div class="field-label-no-margin">Promo Duration</div>
              <input class="form-control" name="promo_start_date" type="date" value="{{ promo.promo_start_date }}">
              <input class="form-control" name="promo_end_date" type="date" value="{{ promo.promo_end_date }}">
              <input class="form-control" name="comm_end_date" type="date" value="{{ promo.comm_end_date }}">
              <div class="radio-group-wrap">
                <label class="radio-label-sm">Duration:</label>
                <label class="radio-label-xs">
                  <input type="radio" name="promo_duration" value="24" {% if promo.promo_duration == 24 %}checked{% endif %}>
                  <span class="radio-text">24</span>
                </label>
                <label class="radio-label-xs">
                  <input type="radio" name="promo_duration" value="30" {% if promo.promo_duration == 30 %}checked{% endif %}>
                  <span class="radio-text">30</span>
                </label>
                <label class="radio-label-xs">
                  <input type="radio" name="promo_duration" value="36" {% if promo.promo_duration == 36 %}checked{% endif %}>
                  <span class="radio-text">36</span>
                </label>
              </div>

              <!-- Delay Time -->
              <div class="field-label-no-margin">Delay Time</div>
              <div class="field-label-no-margin">Application Grace Period</div>
              <div class="field-label-no-margin">Promo Grace</div>
              <div class="field-label-no-margin">Trade-In Grace</div>
              <input class="form-control" name="delay_time" type="number" min="0" value="{{ promo.delay_time }}">
              <div class="radio-group-wrap">
                <label class="radio-label-prefix">Grace:</label>
                {% for grace in ['G11','G12','G13','G14','G15','G16','G17','NULL'] %}
                  <label class="radio-label-prefix">
                    <input type="radio" name="application_grace_period" value="{{ grace }}" {% if promo.application_grace_period == grace %}checked{% endif %}>
                    <span class="radio-text">{{ grace }}</span>
                  </label>
                {% endfor %}
              </div>
              <input class="form-control" name="promo_grace" value="{{ promo.promo_grace }}">
              <input class="form-control" name="trade_in_grace" value="{{ promo.trade_in_grace }}">

              <!-- MPSS Lookback -->
              <div class="field-label-spaced col-span-full">MPSS Lookback</div>
              <input class="form-control col-span-full" name="mpss_lookback" value="{{ promo.mpss_lookback }}">
            </div>
          {% elif active_tab == 'Requirements' %}
            <!-- Requirements Tab Content (Modernized, Consistent Layout) -->
            <div class="grid-4-col">
              <!-- Device Sales Type -->
              <div class="field-label-no-margin">Device Sales Type</div>
              <div class="field-label-no-margin">Activation Type</div>
              <div class="field-label-no-margin">Maintain SOC</div>
              <div class="field-label-no-margin">Limit Per BAN</div>
              <div>
                <div class="radio-group">
                  {% for type in ['J01','S01','*','NULL'] %}
                    <label class="radio-label">
                      <input type="radio" name="device_sales_type" value="{{ type }}" {% if promo.device_sales_type == type %}checked{% endif %}>
                      <span class="radio-text">{{ type }}</span>
                    </label>
                  {% endfor %}
                </div>
              </div>
              <div>
                <div class="radio-group">
                  {% for type in ['AE1','E01','N01','NA1','*','NULL'] %}
                    <label class="radio-label">
                      <input type="radio" name="activation_type" value="{{ type }}" {% if promo.activation_type == type %}checked{% endif %}>
                      <span class="radio-text">{{ type }}</span>
                    </label>
                  {% endfor %}
                </div>
              </div>
              <div>
                <div class="radio-group">
                  <label class="radio-label">
                    <input type="radio" name="maintain_soc" value="Y" {% if promo.maintain_soc == 'Y' %}checked{% endif %}> Y
                  </label>
                  <label class="radio-label">
                    <input type="radio" name="maintain_soc" value="N" {% if promo.maintain_soc == 'N' %}checked{% endif %}> N
                  </label>
                </div>
              </div>
              <div>
                <input class="form-control" name="limit_per_ban" value="{{ promo.limit_per_ban }}">
              </div>

              <!-- Minimum GSM Count -->
              <div class="field-label-no-margin">Minimum GSM Count</div>
              <div class="field-label-no-margin">Maximum GSM Count</div>
              <div class="field-label-no-margin col-span-3-4">Port-In Group ID</div>
              <div>
                <input class="form-control" name="min_gsm_count" value="{{ promo.min_gsm_count }}">
              </div>
              <div>
                <input class="form-control" name="max_gsm_count" value="{{ promo.max_gsm_count }}">
              </div>
              <div class="col-span-3-4">
                <div class="radio-group">
                  {% for group in ['G02','G03','G04','G05','G06','G07','NULL'] %}
                    <label class="radio-label">
                      <input type="radio" name="port_in_group_id" value="{{ group }}" {% if promo.port_in_group_id == group %}checked{% endif %}>
                      <span class="radio-text">{{ group }}</span>
                    </label>
                  {% endfor %}
                </div>
              </div>
            </div>
          {% elif active_tab == 'Segmentation' %}
            <!-- Segmentation Tab Content (Modernized, Consistent Layout) -->
            <div class="grid-4-col">
              <!-- Segment Name -->
              <div class="field-label col-span-full">Segment Name</div>
              <input class="form-control col-span-full form-control-mb" name="segment_name" value="{{ promo.segment_name }}">

              <!-- Sub Segment -->
              <div class="field-label col-span-full">Sub Segment</div>
              <div class="radio-group-wide col-span-full">
                {% for segment in ['Active Military','Family','Reserve','Retired','Promo Code'] %}
                  <label class="radio-label">
                    <input type="radio" name="sub_segment" value="{{ segment }}" {% if promo.sub_segment == segment %}checked{% endif %}>
                    <span class="radio-text">{{ segment }}</span>
                  </label>
                {% endfor %}
              </div>

              <!-- Segment Group ID -->
              <div class="field-label-no-margin col-span-1-3">Segment Group ID</div>
              <div class="field-label-no-margin col-span-3-4">Segment Level</div>
              <input class="form-control col-span-1-3" name="segment_group_id" value="{{ promo.segment_group_id }}">
              <div class="col-span-3-4">
                <div class="radio-group-wide">
                  {% for level in ['BAN','LINE','NA'] %}
                    <label class="radio-label">
                      <input type="radio" name="segment_level" value="{{ level }}" {% if promo.segment_level == level %}checked{% endif %}>
                      <span class="radio-text">{{ level }}</span>
                    </label>
                  {% endfor %}
                </div>
              </div>
            </div>
          {% elif active_tab == 'Requirements' %}
            <!-- Requirements Tab Content (Legacy/Modernized) -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.2rem 0.7rem; align-items: start;">
              <!-- Device Sales Type -->
              <div style="grid-column: 1 / 3; background: var(--tmobile-magenta); color: #fff; font-weight: bold; padding: 0.4rem 0.7rem; border-radius: 4px 4px 0 0; border-bottom: 2px solid #fff;">Device Sales Type</div>
              <div style="grid-column: 1 / 3; display: flex; gap: 1.2rem; align-items: center; background: #f7f7f7; border-radius: 0 0 4px 4px; padding: 0.5rem 0.7rem; border: 1px solid #ccc;">
                {% for type in ['J01','S01','*','NULL'] %}
                  <label style="margin-right: 1.2rem; font-weight: 500; color: #333;">
                    <input type="radio" name="device_sales_type" value="{{ type }}" {% if promo.device_sales_type == type %}checked{% endif %}>
                    <span style="margin-left: 0.2rem;">{{ type }}</span>
                  </label>
                {% endfor %}
              </div>

              <!-- Activation Type -->
              <div style="grid-column: 1 / 3; background: var(--tmobile-magenta); color: #fff; font-weight: bold; padding: 0.4rem 0.7rem; border-radius: 4px 4px 0 0; border-bottom: 2px solid #fff;">Activation Type</div>
              <div style="grid-column: 1 / 3; display: flex; gap: 1.2rem; align-items: center; background: #f7f7f7; border-radius: 0 0 4px 4px; padding: 0.5rem 0.7rem; border: 1px solid #ccc;">
                {% for type in ['AE1','E01','N01','NA1','*','NULL'] %}
                  <label style="margin-right: 1.2rem; font-weight: 500; color: #333;">
                    <input type="radio" name="activation_type" value="{{ type }}" {% if promo.activation_type == type %}checked{% endif %}>
                    <span style="margin-left: 0.2rem;">{{ type }}</span>
                  </label>
                {% endfor %}
              </div>

              <!-- Maintain SOC -->
              <div style="background: var(--tmobile-magenta); color: #fff; font-weight: bold; padding: 0.4rem 0.7rem; border-radius: 4px 4px 0 0; border-bottom: 2px solid #fff;">Maintain SOC</div>
              <div style="display: flex; gap: 1.2rem; align-items: center; background: #f7f7f7; border-radius: 0 0 4px 4px; padding: 0.5rem 0.7rem; border: 1px solid #ccc;">
                <label style="margin-right: 1.2rem; font-weight: 500; color: #333;">
                  <input type="radio" name="maintain_soc" value="Y" {% if promo.maintain_soc == 'Y' %}checked{% endif %}> Y
                </label>
                <label style="margin-right: 1.2rem; font-weight: 500; color: #333;">
                  <input type="radio" name="maintain_soc" value="N" {% if promo.maintain_soc == 'N' %}checked{% endif %}> N
                </label>
              </div>

              <!-- Limit Per BAN -->
              <div style="background: var(--tmobile-magenta); color: #fff; font-weight: bold; padding: 0.4rem 0.7rem; border-radius: 4px 4px 0 0; border-bottom: 2px solid #fff;">Limit Per BAN</div>
              <input class="form-control" name="limit_per_ban" value="{{ promo.limit_per_ban }}">

              <!-- Minimum GSM Count -->
              <div style="background: var(--tmobile-magenta); color: #fff; font-weight: bold; padding: 0.4rem 0.7rem; border-radius: 4px 4px 0 0; border-bottom: 2px solid #fff;">Minimum GSM Count</div>
              <input class="form-control" name="min_gsm_count" value="{{ promo.min_gsm_count }}">

              <!-- Maximum GSM Count -->
              <div style="background: var(--tmobile-magenta); color: #fff; font-weight: bold; padding: 0.4rem 0.7rem; border-radius: 4px 4px 0 0; border-bottom: 2px solid #fff;">Maximum GSM Count</div>
              <input class="form-control" name="max_gsm_count" value="{{ promo.max_gsm_count }}">

              <!-- Port-In Group ID -->
              <div style="grid-column: 1 / 3; background: var(--tmobile-magenta); color: #fff; font-weight: bold; padding: 0.4rem 0.7rem; border-radius: 4px 4px 0 0; border-bottom: 2px solid #fff;">Port-In Group ID</div>
              <div style="grid-column: 1 / 3; display: flex; gap: 1.2rem; align-items: center; background: #f7f7f7; border-radius: 0 0 4px 4px; padding: 0.5rem 0.7rem; border: 1px solid #ccc;">
                {% for group in ['G02','G03','G04','G05','G06','G07','NULL'] %}
                  <label style="margin-right: 1.2rem; font-weight: 500; color: #333;">
                    <input type="radio" name="port_in_group_id" value="{{ group }}" {% if promo.port_in_group_id == group %}checked{% endif %}>
                    <span style="margin-left: 0.2rem;">{{ group }}</span>
                  </label>
                {% endfor %}
              </div>
            </div>
          {% elif active_tab == 'BPTCR' %}
            <!-- BPTCR Tab Content -->
            <div class="grid-1-col-max">
              <!-- C2 Link Section -->
              <div class="field-label">C2 Link Configuration</div>
              <div class="content-section">
                <div class="c2-link-grid">
                  <label class="font-weight-500 color-333">C2 Link URL:</label>
                  <input class="form-control c2-link-input" name="c2_link" value="{{ promo.c2_link or 'https://c2.t-mobile.com/offers/' }}" placeholder="Enter C2 link URL">
                </div>
                <div class="info-text">
                  <i class="fas fa-info-circle" style="margin-right: 0.5rem;"></i>
                  This link will be used in the promotion system to direct customers to the appropriate offer page.
                </div>
              </div>

              <!-- Jira Ticket Section -->
              <div class="field-label">Jira Ticket Management</div>
              <div class="content-section">
                <div class="jira-ticket-wrapper">
                  <div class="jira-ticket-header">
                    <div class="jira-ticket-info">
                      <h4>Generate BPTCR Jira Ticket</h4>
                      <p>Create a new Jira ticket for BPTCR approval process</p>
                    </div>
                    <button type="button" class="btn-primary-jira" onclick="generateJiraTicket()">
                      <i class="fas fa-ticket-alt" style="margin-right: 0.5rem;"></i>
                      Generate Jira Ticket
                    </button>
                  </div>
                  
                  <!-- Jira Ticket Status (Initially Hidden) -->
                  <div id="jira-ticket-status" class="jira-ticket-status">
                    <div class="jira-success-box">
                      <div class="jira-success-title">
                        <i class="fas fa-check-circle" style="margin-right: 0.5rem;"></i>
                        Jira Ticket Created Successfully
                      </div>
                      <div class="jira-success-text">
                        <strong>Ticket ID:</strong> <span id="jira-ticket-id">BPTCR-{{ promo.code }}-2025-07-14</span>
                      </div>
                      <div class="jira-success-text-spaced">
                        <strong>Status:</strong> Open - Pending BPTCR Review
                      </div>
                      <div class="jira-actions">
                        <button type="button" class="btn btn-outline-secondary" onclick="viewJiraTicket()">
                          <i class="fas fa-external-link-alt" style="margin-right: 0.5rem;"></i>
                          View in Jira
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="copyJiraTicketId()">
                          <i class="fas fa-copy" style="margin-right: 0.5rem;"></i>
                          Copy Ticket ID
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- BPTCR Approval Workflow -->
              <div class="field-label">BPTCR Approval Workflow</div>
              <div class="content-section">
                <div class="workflow-grid">
                  <div class="workflow-card">
                    <div class="workflow-number">1</div>
                    <div class="workflow-title">Submit Request</div>
                    <div class="workflow-description">Generate Jira ticket for BPTCR review</div>
                  </div>
                  <div class="workflow-card">
                    <div class="workflow-number">2</div>
                    <div class="workflow-title">BPTCR Review</div>
                    <div class="workflow-description">Business team reviews promotion details</div>
                  </div>
                  <div class="workflow-card">
                    <div class="workflow-number">3</div>
                    <div class="workflow-title">Approval</div>
                    <div class="workflow-description">Final approval and implementation</div>
                  </div>
                </div>
              </div>
            </div>
          {% elif active_tab == 'Export to CSV' %}
            <!-- Export to CSV Tab Content -->
            <div class="grid-1-col">
              <!-- CSV Upload Section -->
              <div class="field-label">Upload SKU List</div>
              
              <!-- File Upload Area -->
              <div class="file-upload-area">
                <div class="file-upload-content">
                  <div class="file-upload-icon">
                    <i class="fas fa-upload"></i>
                  </div>
                  <div class="file-upload-title">Upload your SKU list Excel file</div>
                  <div class="file-upload-subtitle">Drag and drop or click to select a file</div>
                </div>
                <input type="file" name="sku_excel" accept=".xlsx,.xls" style="display: none;" id="sku-upload">
                <label for="sku-upload" class="file-upload-button">
                  Choose Excel File
                </label>
                <div id="file-name" class="file-name-display">
                  <strong>Selected file:</strong> <span id="selected-file-name"></span>
                </div>
              </div>
              
              <!-- Generate Button -->
              <div class="button-center">
                <button type="button" class="btn-primary" onclick="generateInsertStatements()">
                  Generate INSERT Statements
                </button>
              </div>
              
              <!-- Results Area (Initially Hidden) -->
              <div id="insert-results" class="results-section">
                <div class="field-label">Generated INSERT Statements</div>
                <div class="results-container">
                  <pre id="insert-statements-content" class="results-content"></pre>
                </div>
                <div class="results-actions">
                  <button type="button" class="btn btn-secondary" onclick="copyToClipboard()">Copy to Clipboard</button>
                  <button type="button" class="btn btn-success" onclick="downloadStatements()">Download SQL File</button>
                </div>
              </div>
            </div>
          {% elif active_tab == 'Groupings' %}
            <!-- Groupings Tab Content -->
            <div class="grid-2-col">
              <!-- SOC Grouping -->
              <div class="field-label col-span-2-full text-center">SOC Grouping</div>
              <div class="form-select-wrapper">
                <select class="form-select" name="soc_grouping">
                  <option value="Group 1NS">Group 1NS</option>
                  <option value="Group 3">Group 3</option>
                  <option value="Group 4">Group 4</option>
                  <option value="Group 5">Group 5</option>
                  <option value="Group 6">Group 6</option>
                </select>
              </div>
              <div class="content-section-info">
                <ul class="info-list">
                  <li class="bold">Group 1NS - GSM - Consumer & TFB</li>
                  <li>T-Mobile ONE rate plans</li>
                  <li>Magenta rate plans</li>
                  <li>Essentials rate plans</li>
                  <li>Bus/Gov Unlimited rate plans</li>
                  <li class="bold">Group 3 - MI - Consumer & TFB</li>
                  <li>10GB or higher Mobile Internet rate plans (limited buckets)</li>
                  <li>Excludes unlimited highspeed data plans</li>
                  <li class="bold">Group 4 - GSM - Consumer & TFB - excludes PlusUP & MAXUp line level upsell SOCs)</li>
                  <li class="bold">Group 5 - MI - All MTME Eligible MI/BTS - Consumer & TFB</li>
                  <li class="bold">Group 6 - GSM - Consumer & TFB</li>
                  <li>TMO ONE Plus rate plans (Incl. 55+)</li>
                  <li>Magenta Plus rate plans (Incl. First Responder & 55+)</li>
                  <li>Magenta MAX rate plans (Incl. First responder & 55+)</li>
                  <li>TMO ONE Plus Military rate plans</li>
                  <li>Magenta Plus Military rate plans</li>
                  <li>Magenta MAX Military rate plans</li>
                  <li>Business Unlimited Plus plans</li>
                  <li>Magenta Plus DHH plans</li>
                  <li>Magenta MAX DHH plans</li>
                  <li>Business Unlimited Ultimate plans</li>
                  <li>Plus Up Upsell SOCs (Include Intl/Global Plus SOCs)</li>
                  <li>MAXUp Upsell SOCs</li>
                  <li>Business Unlimited Upsell SOCs (Ultimate)</li>
                </ul>
              </div>

              <!-- Account Type -->
              <div class="field-label-spaced col-span-2-full">Account Type</div>
              <div>
                <select class="form-select">
                  <option value="A01">A01</option>
                  <option value="A02">A02</option>
                  <option value="A03">A03</option>
                  <option value="A04">A04</option>
                  <option value="A05">A05</option>
                  <option value="A06">A06</option>
                  <option value="A07">A07</option>
                  <option value="A08">A08</option>
                  <option value="A09">A09</option>
                  <option value="A10">A10</option>
                </select>
              </div>
              <div class="content-section-info-sm">
                <ul class="info-list">
                  <li>Regular (I/R); Association (I/A); GSA (I/F); Government (I/G); MCSA (I/M)</li>
                  <li>Corporate (B/C); Retail (B/L); MCSA (B/M); National (B/N); MCSAGE (B/O)</li>
                  <li>Non-Profit (B/P); Sole-Proprietorship (I/S)</li>
                  <li>Employee (S/Y); Non TMO Employee (S/6)</li>
                </ul>
              </div>

              <!-- Sales Applications -->
              <div class="field-label-spaced col-span-2-full">Sales Applications</div>
              <div>
                <select class="form-select">
                  <option value="S01">S01</option>
                  <option value="S02">S02</option>
                  <option value="S03">S03</option>
                  <option value="S04">S04</option>
                  <option value="S05">S05</option>
                  <option value="S06">S06</option>
                  <option value="S07">S07</option>
                  <option value="S08">S08</option>
                  <option value="S09">S09</option>
                  <option value="S10">S10</option>
                </select>
              </div>
              <div class="content-section-info-sm">
                <ul class="info-list">
                  <li>Care - QVXPC; Dash (TSL) - Virtual Retail</li>
                  <li>QVXPR - Retail; POS - Retail; NAT - National Retail</li>
                  <li>Web (TMO) - T-Mo.com; Web - MyT-Mo (cloud)</li>
                  <li>Costco with EIP; BestBuy</li>
                </ul>
              </div>
            </div>
          {% endif %}
          {% if active_tab != 'Export to CSV' %}
          <div class="action-buttons mt-2">
            <button type="submit" class="btn btn-primary">Save {{ active_tab }}</button>
            <button type="button" class="btn btn-secondary">Cancel</button>
          </div>
          {% endif %}
        </form>
      </div>
    </div>
  </div>

  <!-- JavaScript for all interactive functionality -->
  <script>
    // BPTCR functionality
    function generateJiraTicket() {
      const ticketId = 'BPTCR-{{ promo.code }}-' + new Date().toISOString().split('T')[0];
      
      const button = event.target;
      const originalText = button.innerHTML;
      button.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 0.5rem;"></i>Generating...';
      button.disabled = true;
      
      setTimeout(() => {
        document.getElementById('jira-ticket-id').textContent = ticketId;
        document.getElementById('jira-ticket-status').style.display = 'block';
        
        button.innerHTML = originalText;
        button.disabled = false;
        
        alert('Jira ticket created successfully: ' + ticketId);
      }, 2000);
    }
    
    function viewJiraTicket() {
      const ticketId = document.getElementById('jira-ticket-id').textContent;
      alert('Opening Jira ticket: ' + ticketId + '\n(In production, this would open the actual Jira URL)');
    }
    
    function copyJiraTicketId() {
      const ticketId = document.getElementById('jira-ticket-id').textContent;
      navigator.clipboard.writeText(ticketId).then(function() {
        alert('Ticket ID copied to clipboard: ' + ticketId);
      });
    }

    // Export to CSV functionality
    document.getElementById('sku-upload').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        document.getElementById('selected-file-name').textContent = file.name;
        document.getElementById('file-name').style.display = 'block';
      }
    });
    
    function generateInsertStatements() {
      const fileInput = document.getElementById('sku-upload');
      const file = fileInput.files[0];
      
      if (!file) {
        alert('Please select an Excel file first.');
        return;
      }
      
      const demoSqlContent = `-- User Story No. 			= CPO-15843
-- Requested By 			= Cade Holtzen
-- Request Date(DD/MM/YYYY) = 04/02/2025 
-- Project 					= EFPE Device - New Promo R043 - Orbit 23578 - NR x Apple: $800 off iPhone 16 w/Trade on Go5G Plus/Next - Launch 04/03/2025
-------------------------------------------------------------------------

--PROD / ZLAB
BEGIN

--PROMO_ELIGIBILITY_RULES 

Insert into PROMO_ELIGIBILITY_RULES (RULE_ID,PROMO_CODE,PROMO_START_DATE,PROMO_END_DATE,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,PROMO_DESCRIPTION,PROMO_DURATION,PROMO_AMOUNT,EFFECTIVE_DATE,EXPIRATION_DATE,SKU_GROUP_ID,PRIM_SKU_GROUP_ID,SOC_GROUP_ID,ATST_GROUP_ID,APPL_GROUP_ID,DEVICE_ST_GROUP_ID,FINANCE_TYPE,ACT_LINE_REQ_IND,APP_GRACE_GROUP_ID,TRADE_IN_GRP_ID,TRADE_IN_GRACE_PERIOD,MAINT_ACT_LINE_CHK_IND,MAINT_SOC_CHK_IND,STORE_GRP_ID,MARKET_GRP_ID,LIMIT_PER_BAN,TENURE_GROUP_ID,PORTIN_GROUP_ID,PROMO_PERC_DISC,C2_LINK,MIN_GSM_COUNT,MAX_GSM_COUNT,DISPLAY_PROMO,TIERED_GRP_ID,SEGMENT_GRP_ID,BOLTON_TRADE_IN_GRP_ID,PRODUCT_TYPE,PR_DATE,PROMO_GRACE_PERIOD,LINE_ST_GROUP_ID,NSEIP_DROP_IND,DELAY_TIME,DISPLAY_PROMO_START_DATE, DISPLAY_PROMO_END_DATE, MPSS_LOOKBACK, FLOW_INDICATOR, DOCUMENT_ID, DVC_STS_GRP_ID, CLAWBACK_IND) values (PROMO_ELIGIBILITY_RULES_1SQ.NEXTVAL,'R043',to_date('04/02/2025 20:00:00','MM/DD/YYYY HH24:MI:SS'),to_date('07/10/2025 05:00:00','MM/DD/YYYY HH24:MI:SS'),sysdate,15483,'CPO','USRST','Apple Retail Trade ID250078',24,NULL,to_date('04/02/2025 20:00:00','MM/DD/YYYY HH24:MI:SS'),to_date('07/10/2028 05:00:00','MM/DD/YYYY HH24:MI:SS'),'W44',NULL,'A7N','A13','S15','S01','LOAN','Y',NULL,'L81',32,'Y','Y','*','*','4',NULL,NULL,NULL,'https://c2.t-mobile.com/offers/ec1df',NULL,12,'Y',NULL,NULL,NULL,'G',NULL,NULL,'*','N',NULL,to_date('04/03/2025 00:00:00','MM/DD/YYYY HH24:MI:SS'),to_date('07/09/2025 00:00:00','MM/DD/YYYY HH24:MI:SS'),14,NULL,'ec1df','DS1','N');


--PROMO_DEVICE_GROUPS

Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035005',sysdate,15483,'CPO','USRST','APL IPHONE 15 128G BLK KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035012',sysdate,15483,'CPO','USRST','APL IPHONE 15 128G PNK KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035029',sysdate,15483,'CPO','USRST','APL IPHONE 15 128G YLW KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035036',sysdate,15483,'CPO','USRST','APL IPHONE 15 128G BLU KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035043',sysdate,15483,'CPO','USRST','APL IPHONE 15 128G GRN KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035050',sysdate,15483,'CPO','USRST','APL IPHONE 15 256G BLK KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035067',sysdate,15483,'CPO','USRST','APL IPHONE 15 256G PNK KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035074',sysdate,15483,'CPO','USRST','APL IPHONE 15 256G YLW KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035081',sysdate,15483,'CPO','USRST','APL IPHONE 15 256G BLU KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035098',sysdate,15483,'CPO','USRST','APL IPHONE 15 256G GRN KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035104',sysdate,15483,'CPO','USRST','APL IPHONE 15 512G BLK KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035111',sysdate,15483,'CPO','USRST','APL IPHONE 15 512G PNK KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035128',sysdate,15483,'CPO','USRST','APL IPHONE 15 512G YLW KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035135',sysdate,15483,'CPO','USRST','APL IPHONE 15 512G BLU KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');
Insert into PROMO_DEVICE_GROUPS (SKU_GROUP_ID,SKU,SYS_CREATION_DATE,OPERATOR_ID,APPLICATION_ID,DL_SERVICE_CODE,SKU_DESCRIPTION,SKU_GROUP_DESCRIPTION) values ('W44','000000195949035142',sysdate,15483,'CPO','USRST','APL IPHONE 15 512G GRN KIT','NEW PROMO R043 - CPO-15483 Orbit 23578 - Apple Retail Trade ID250078');

-- Additional INSERT statements continue...
-- (Truncated for demo - full file contains 100+ device records)

END;`;
    
      document.getElementById('insert-statements-content').textContent = demoSqlContent;
      document.getElementById('insert-results').style.display = 'block';
    }
    
    function copyToClipboard() {
      const content = document.getElementById('insert-statements-content').textContent;
      navigator.clipboard.writeText(content).then(function() {
        alert('INSERT statements copied to clipboard!');
      });
    }
    
    function downloadStatements() {
      const content = document.getElementById('insert-statements-content').textContent;
      const blob = new Blob([content], { type: 'text/plain' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'PCR_CPO-15843-R043-NewPromo.sql';
      a.click();
      window.URL.revokeObjectURL(url);
    }
  </script>
{% endblock %}
